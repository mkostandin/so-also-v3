# Feature 0036: Fix Committee Filter Reloading on View Switch

## Problem
The committee filter dropdown reloads ("Loading committees..." message) whenever users switch between map, list, and calendar views. This creates poor UX compared to the event type filter which remains consistent.

## Root Cause
The `CommitteeFilter` component fetches committees from the API every time it's mounted (during view switches), unlike the `EventTypeFilter` which uses static data.

## Solution Implemented
Implemented a simpler localStorage caching solution directly in the `CommitteeFilter` component to prevent reloading on view switches, rather than the originally planned complex centralized approach.

## Files Modified

### `ui/src/components/CommitteeFilter.tsx`
- ✅ Added localStorage caching with 5-minute expiry
- ✅ Check cached data before making API calls
- ✅ Use cached data if less than 5 minutes old
- ✅ Fallback to cached data if API fails
- ✅ Use sample data as final fallback

### `server/src/api/committees.ts`
- ✅ Fixed import error: `getDatabaseUrl` was imported from wrong module
- ✅ Changed from `import { getDatabase, getDatabaseUrl } from '../lib/db'`
- ✅ To correct: `import { getDatabase } from '../lib/db'; import { getDatabaseUrl } from '../lib/env'`

## Implementation Details

### Simple localStorage Caching Pattern
```typescript
// Check if we have cached data that's less than 5 minutes old
const cached = localStorage.getItem('cached-committees');
if (cached) {
  const { data, timestamp } = JSON.parse(cached);
  const cacheAge = Date.now() - timestamp;
  const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes

  if (cacheAge < CACHE_DURATION) {
    setCommittees(data);
    setLoading(false);
    return; // Skip API call
  }
}

// Cache successful API responses
localStorage.setItem('cached-committees', JSON.stringify({
  data: data || [],
  timestamp: Date.now()
}));
```

## Testing Completed
- ✅ Switch between map/list/calendar views - no "Loading committees..." message
- ✅ Committee selections persist across view switches
- ✅ Committee data loads once and uses cache for subsequent loads
- ✅ Error handling works with cached data fallback
- ✅ API import error fixed and endpoint working correctly
- ✅ No linter errors introduced

## Benefits Achieved
- **Simple & Effective**: Direct localStorage caching in the component
- **Consistent UX**: No loading states when switching views
- **Performance**: Reduced API calls with 5-minute cache expiry
- **Reliable**: Multiple fallback layers (cache → sample data)
- **Minimal Changes**: No complex architecture changes needed

## Additional Issue Fixed
During testing, discovered and fixed a server-side API import error that was causing the committees endpoint to return 500 errors. The `getDatabaseUrl` function was being imported from the wrong module.
