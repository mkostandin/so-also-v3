# Feature: Shared Event Type Filtering Across Views

## Brief Description
Implement shared event type filtering that persists across Map, List, and Calendar views. The EventTypeFilter component will be added to all three views and maintain selected filter state when users switch between views.

## Current State Analysis
- MapView currently has EventTypeFilter with local state management
- ListView and CalendarView lack event type filtering entirely
- Each view manages its own state independently
- MapIndex provides navigation between views via tabs

## Technical Implementation Plan

### Phase 1: State Management Refactor
**Files to modify:**
- `ui/src/routes/MapIndex.tsx` - Add selectedEventTypes state and pass to child views
- `ui/src/routes/MapView.tsx` - Remove local state, receive as props

**Implementation:**
1. Move `selectedEventTypes` state from MapView to MapIndex
2. Create shared state with initial value `[...EVENT_TYPES]` (all selected)
3. Pass state and setter to MapView via props

### Phase 2A: ListView Enhancement
**Files to modify:**
- `ui/src/routes/ListView.tsx` - Add EventTypeFilter and filtering logic

**Implementation:**
1. Import EventTypeFilter component
2. Add component to UI layout (similar positioning to MapView)
3. Implement filtering logic in `sorted` useMemo hook
4. Filter events based on `event.eventType` matching selected types
5. Receive selectedEventTypes as props from MapIndex

### Phase 2B: CalendarView Enhancement
**Files to modify:**
- `ui/src/routes/CalendarView.tsx` - Add EventTypeFilter and filtering logic
- `ui/src/hooks/useCalendarEvents.ts` - Accept selectedEventTypes parameter

**Implementation:**
1. Import EventTypeFilter component
2. Add component to UI layout (similar positioning to MapView)
3. Modify useCalendarEvents to accept selectedEventTypes parameter
4. Implement filtering logic in hook's event processing
5. Filter events based on `event.eventType` matching selected types
6. Receive selectedEventTypes as props from MapIndex

### Phase 3: Integration and Testing
**Files to modify:**
- `ui/src/routes/MapIndex.tsx` - Pass selectedEventTypes to all child views

**Implementation:**
1. Update MapIndex to pass selectedEventTypes to ListView and CalendarView
2. Ensure consistent UI positioning of EventTypeFilter across all views
3. Test filter persistence when switching between views
4. Verify filtering works correctly in all three views

## Key Technical Details

### Event Type Matching Logic
```typescript
// Used in MapboxMap.tsx and will be used in ListView/CalendarView
const shouldIncludeEvent = (event: EventItem, selectedTypes: string[]) => {
  if (selectedTypes.length === 0) return true;
  return event.eventType && selectedTypes.includes(event.eventType);
};
```

### State Management
- State lifted to MapIndex component
- Passed down via props to all child views
- Consistent with React patterns for shared state

### UI Consistency
- EventTypeFilter positioned consistently across views
- Same styling and behavior in all contexts
- Responsive design maintained

### Data Flow
MapIndex (state) → MapView/ListView/CalendarView (props) → EventTypeFilter (UI) → MapIndex (callback)

## Files Requiring Changes
- `ui/src/routes/MapIndex.tsx` (new state management)
- `ui/src/routes/MapView.tsx` (remove local state, use props)
- `ui/src/routes/ListView.tsx` (add filter + filtering logic)
- `ui/src/routes/CalendarView.tsx` (add filter + filtering logic)
- `ui/src/hooks/useCalendarEvents.ts` (accept filter parameter)

## Testing Requirements
- Filter selections persist when switching views
- Filtering works correctly in Map, List, and Calendar views
- All event types can be filtered independently
- UI remains consistent across views
- Performance impact minimal (filtering done in useMemo/useCallback)
