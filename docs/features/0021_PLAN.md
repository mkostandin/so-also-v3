# Configurable Calendar Distance Filter

## Brief Description
Replace the fixed 50-mile calendar distance limit with a configurable filter offering options for "All Events" (no distance limit), "500 miles", "150 miles", and "50 miles". Remove the hardcoded 200 events range limit in favor of distance-based filtering.

## Technical Implementation Plan

### Phase 1: Distance Configuration State Management

#### Extend Filter Context
- **File**: `ui/src/routes/MapIndex.tsx`
- **Changes**: Add `selectedDistance` state to `FilterContextType` interface and provider
- **Default Value**: Set initial state to "150 miles" for broader coverage
- **State Type**: `string` with values: "all", "500", "150", "50"

#### Update Filter Context Interface
```typescript
interface FilterContextType {
	selectedEventTypes: string[];
	setSelectedEventTypes: (types: string[] | ((prev: string[]) => string[])) => void;
	selectedDistance: string;
	setSelectedDistance: (distance: string) => void;
}
```

### Phase 2: Distance Filter Component

#### Create DistanceFilter Component
- **New File**: `ui/src/components/DistanceFilter.tsx`
- **Options**: Four distance options as pill-style buttons matching EventTypeFilter design
- **Options Array**: `['All Events', '500 miles', '150 miles', '50 miles']`
- **Styling**: Match existing EventTypeFilter pill button design with active/inactive states

#### Distance Filter Props Interface
```typescript
interface DistanceFilterProps {
	selectedDistance: string;
	onDistanceChange: (distance: string) => void;
}
```

### Phase 3: Update Calendar Logic

#### Modify useCalendarEvents Hook
- **File**: `ui/src/hooks/useCalendarEvents.ts`
- **Changes**:
  - Accept `distance` parameter instead of `range`
  - Convert distance string to radius meters:
    - "all" → no radius parameter (undefined)
    - "500" → 804670 meters (500 miles)
    - "150" → 241402 meters (150 miles)
    - "50" → 80467 meters (50 miles)
  - Remove default range parameter

#### Update Hook Signature
```typescript
export function useCalendarEvents(distance: string = "150", selectedEventTypes: string[] = []): CalendarEventsData
```

#### Distance to Meters Conversion Function
```typescript
const getRadiusFromDistance = (distance: string): number | undefined => {
	switch (distance) {
		case "all": return undefined;
		case "500": return 804670; // 500 miles in meters
		case "150": return 241402; // 150 miles in meters
		case "50": return 80467;   // 50 miles in meters
		default: return 241402;
	}
};
```

### Phase 4: Update Calendar View

#### Update CalendarView Component
- **File**: `ui/src/routes/CalendarView.tsx`
- **Changes**:
  - Import new `DistanceFilter` component
  - Add `selectedDistance` and `setSelectedDistance` from filter context
  - Replace `useCalendarEvents(200, selectedEventTypes)` with `useCalendarEvents(selectedDistance, selectedEventTypes)`
  - Add DistanceFilter component to the UI layout above or alongside EventTypeFilter
  - Update "Showing nearest X events" text to reflect distance-based filtering

#### Distance Filter Placement
Position the DistanceFilter component in the filter section alongside EventTypeFilter, maintaining consistent spacing and styling.

### Phase 5: Update "Showing Events" Text

#### Dynamic Event Count Display
- **File**: `ui/src/routes/CalendarView.tsx`
- **Changes**: Update the event count text to reflect the selected distance:
  - "All Events": "Showing all events"
  - "500 miles": "Showing events within 500 miles"
  - "150 miles": "Showing events within 150 miles"
  - "50 miles": "Showing events within 50 miles"

### Files to Modify

1. **ui/src/routes/MapIndex.tsx**
   - Extend FilterContextType interface
   - Add selectedDistance state and setter
   - Update FilterContext.Provider value

2. **ui/src/hooks/useCalendarEvents.ts**
   - Change function signature from `range: number = 200` to `distance: string = "50"`
   - Add distance to meters conversion function
   - Use radius parameter conditionally (undefined for "all events")

3. **ui/src/routes/CalendarView.tsx**
   - Import DistanceFilter component
   - Use selectedDistance from filter context
   - Update useCalendarEvents call
   - Add DistanceFilter to UI layout
   - Update event count display text

### New Components Required

1. **ui/src/components/DistanceFilter.tsx**
   - Pill-style distance filter buttons
   - Active/inactive state styling
   - Click handlers for distance selection

### API Integration Notes

- **Radius Parameter**: When `radius` is undefined, the API will return all events regardless of distance
- **Backward Compatibility**: Existing API calls will work unchanged
- **Performance**: "All Events" option may return significantly more data

### Testing Considerations

- Verify all distance options work correctly with 150 miles as default
- Test API calls with and without radius parameter
- Confirm UI shows "150 miles" as initially selected
- Test distance filter changes update event count display properly
- Test with location permission granted/denied scenarios
- Verify event count display updates appropriately ("Showing events within 150 miles")
